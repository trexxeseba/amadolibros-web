<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amado Libros ‚Ä¢ Librer√≠a Online Uruguay ‚Ä¢ Pickup Ciudad Vieja</title>
    <meta name="description" content="La librer√≠a m√°s r√°pida de Uruguay. Env√≠os en 2h, 12% de descuento por transferencia y pickup en Ciudad Vieja.">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìö‚ù§Ô∏è</text></svg>">
    
    <!-- Preconnect para Performance -->
    <link rel="preconnect" href="https://http2.mlstatic.com">
    
    <style>
        :root {
            --primary: #FF6B35;
            --primary-dark: #E55A2B;
            --secondary: #3483FA;
            --light: #F8F9FA;
            --dark: #1A1A2E;
            --text-dark: #333333;
            --text-light: #666666;
            --card: #FFFFFF;
            --border: #E8E8E8;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: var(--light);
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }

        /* HEADER OPTIMIZADO */
        .header {
            background: var(--card);
            border-bottom: 3px solid var(--primary);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            height: 70px;
            display: flex;
            align-items: center;
        }
        .header-content { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .logo { font-size: 24px; font-weight: 800; color: var(--primary); text-decoration: none; }

        /* HERO SECTION */
        .hero {
            background: linear-gradient(135deg, #FF6B35 0%, #FF8E53 100%);
            color: white;
            padding: 60px 20px;
            text-align: center;
        }
        .hero h1 { font-size: 2.5rem; font-weight: 900; margin-bottom: 10px; }
        .hero p { font-size: 1.2rem; opacity: 0.9; }

        /* BUSCADOR CON DEBOUNCE */
        .search-section { margin-top: -35px; margin-bottom: 40px; }
        .search-box {
            background: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex;
            gap: 10px;
        }
        .search-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 18px;
            outline: none;
            transition: border-color 0.3s;
        }
        .search-input:focus { border-color: var(--primary); }

        /* GRID DE LIBROS */
        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 25px;
            margin-bottom: 50px;
        }
        .book-card {
            background: var(--card);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border);
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            flex-direction: column;
        }
        .book-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        
        .book-img-wrapper { aspect-ratio: 2/3; background: #f0f0f0; position: relative; overflow: hidden; }
        .book-img { width: 100%; height: 100%; object-fit: cover; transition: opacity 0.3s; }
        
        .book-content { padding: 15px; flex-grow: 1; display: flex; flex-direction: column; }
        .book-title { font-size: 17px; font-weight: 700; margin-bottom: 5px; color: var(--dark); height: 2.4em; overflow: hidden; }
        .book-author { font-size: 14px; color: var(--text-light); margin-bottom: 15px; }
        
        .book-pricing { margin-top: auto; }
        .price-main { font-size: 22px; font-weight: 800; color: var(--primary); display: flex; align-items: center; gap: 8px; }
        .discount-badge { font-size: 12px; background: #FFF3E0; color: #E65100; padding: 2px 8px; border-radius: 4px; font-weight: 700; }
        .price-regular { font-size: 13px; color: var(--text-light); text-decoration: line-through; }
        .price-installments { font-size: 13px; color: var(--secondary); font-weight: 600; margin-top: 4px; }

        .book-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .btn { padding: 10px; border-radius: 8px; text-decoration: none; font-size: 13px; font-weight: 700; text-align: center; transition: opacity 0.2s; }
        .btn-ml { background: var(--secondary); color: white; }
        .btn-wpp { background: #25D366; color: white; }
        .btn:hover { opacity: 0.9; }

        /* SKELETON LOADING */
        .skeleton { background: #eee; background: linear-gradient(110deg, #ececec 8%, #f5f5f5 18%, #ececec 33%); border-radius: 5px; background-size: 200% 100%; animation: 1.5s shine linear infinite; }
        @keyframes shine { to { background-position-x: -200%; } }

        /* FOOTER */
        .footer { background: var(--dark); color: white; padding: 40px 0; text-align: center; margin-top: 60px; }
    </style>
</head>
<body>

    <header class="header">
        <div class="container header-content">
            <a href="/" class="logo">üìö Amado Libros</a>
            <div style="font-size: 14px; font-weight: 600; color: var(--text-light);">Uruguay ‚Ä¢ 100% Online</div>
        </div>
    </header>

    <section class="hero">
        <div class="container">
            <h1>Tu pr√≥xima lectura, hoy.</h1>
            <p>Env√≠os r√°pidos en Montevideo y todo el pa√≠s.</p>
        </div>
    </section>

    <main class="container">
        <section class="search-section">
            <div class="search-box">
                <input type="text" id="searchInput" class="search-input" placeholder="Busca por t√≠tulo, autor o ISBN...">
            </div>
        </section>

        <div id="booksGrid" class="books-grid">
            <!-- Skeletons iniciales -->
            <div class="book-card"><div class="book-img-wrapper skeleton"></div><div class="book-content"><div class="skeleton" style="height:20px;margin-bottom:10px"></div><div class="skeleton" style="height:15px;width:60%"></div></div></div>
            <div class="book-card"><div class="book-img-wrapper skeleton"></div><div class="book-content"><div class="skeleton" style="height:20px;margin-bottom:10px"></div><div class="skeleton" style="height:15px;width:60%"></div></div></div>
            <div class="book-card"><div class="book-img-wrapper skeleton"></div><div class="book-content"><div class="skeleton" style="height:20px;margin-bottom:10px"></div><div class="skeleton" style="height:15px;width:60%"></div></div></div>
            <div class="book-card"><div class="book-img-wrapper skeleton"></div><div class="book-content"><div class="skeleton" style="height:20px;margin-bottom:10px"></div><div class="skeleton" style="height:15px;width:60%"></div></div></div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>¬© 2026 Amado Libros - Librer√≠a Online Uruguay</p>
            <p style="font-size: 13px; opacity: 0.7; margin-top: 10px;">Precios din√°micos sincronizados con Mercado Libre</p>
        </div>
    </footer>

    <script>
        let allBooks = [];
        const grid = document.getElementById('booksGrid');
        const searchInput = document.getElementById('searchInput');

        // Cargar libros desde el Worker Proxy
        async function fetchBooks() {
            try {
                const response = await fetch('https://amado-libros-proxy.undiaes.workers.dev/api/books');
                if (!response.ok) throw new Error('API no disponible');
                allBooks = await response.json();
                renderBooks(allBooks);
            } catch (e) {
                console.error("Error:", e);
                grid.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:40px;">
                    <p>No pudimos cargar el cat√°logo. Por favor, intenta m√°s tarde o cont√°ctanos por WhatsApp.</p>
                    <a href="https://wa.me/59899841325" class="btn btn-wpp" style="display:inline-block;margin-top:20px">Consultar por WhatsApp</a>
                </div>`;
            }
        }

        function renderBooks(books) {
            if (books.length === 0) {
                grid.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:40px;"><h3>No encontramos resultados</h3></div>`;
                return;
            }

            grid.innerHTML = books.map(book => {
                const discountPrice = Math.round(book.price * 0.88);
                const installments = (book.price / 12).toFixed(2);
                
                // Optimizaci√≥n de imagen v√≠a Cloudflare Image Resizing
                const imgUrl = window.location.hostname === 'localhost' || window.location.hostname.includes('github.io') 
                    ? book.image 
                    : `/cdn-cgi/image/format=webp,quality=85,width=400/${book.image}`;

                return `
                    <article class="book-card">
                        <div class="book-img-wrapper">
                            <img src="${imgUrl}" alt="${book.title}" class="book-img" loading="lazy">
                        </div>
                        <div class="book-content">
                            <h3 class="book-title">${book.title}</h3>
                            <p class="book-author">${book.author || 'Autor desconocido'}</p>
                            
                            <div class="book-pricing">
                                <div class="price-main">
                                    $${discountPrice.toLocaleString('es-UY')}
                                    <span class="discount-badge">12% OFF</span>
                                </div>
                                <div class="price-regular">Precio ML: $${book.price.toLocaleString('es-UY')}</div>
                                <div class="price-installments">12 cuotas de $${installments}</div>
                            </div>

                            <div class="book-actions">
                                <a href="${book.meliLink}" target="_blank" class="btn btn-ml">Ver en ML</a>
                                <a href="https://wa.me/59899841325?text=Hola! Me interesa: ${encodeURIComponent(book.title)}" target="_blank" class="btn btn-wpp">WhatsApp</a>
                            </div>
                        </div>
                    </article>
                `;
            }).join('');
        }

        // Debounce para b√∫squeda eficiente
        function debounce(func, wait) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        }

        const handleSearch = debounce((e) => {
            const term = e.target.value.toLowerCase().trim();
            if (!term) {
                renderBooks(allBooks);
                return;
            }
            const filtered = allBooks.filter(b => 
                b.title.toLowerCase().includes(term) || 
                (b.author && b.author.toLowerCase().includes(term)) ||
                (b.isbn && b.isbn.includes(term))
            );
            renderBooks(filtered);
        }, 300);

        searchInput.addEventListener('input', handleSearch);

        // Inicializar
        fetchBooks();
    </script>
</body>
</html>
