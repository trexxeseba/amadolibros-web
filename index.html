<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Amado Libros</title>
  <meta name="description" content="Amado Libros — Libros importados, pedidos especiales y atención por WhatsApp." />

  <style>
    :root{
      --bg:#0b0f14;
      --card:rgba(255,255,255,0.06);
      --stroke:rgba(255,255,255,0.12);
      --text:rgba(255,255,255,0.92);
      --muted:rgba(255,255,255,0.72);
      --soft:rgba(255,255,255,0.10);
      --shadow:0 26px 80px rgba(0,0,0,0.55);
      --radius:22px;
      --max:980px;
      --btn:rgba(255,255,255,0.10);
      --btnHover:rgba(255,255,255,0.16);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:
        radial-gradient(900px 600px at 15% 20%, rgba(255,255,255,0.08), transparent 60%),
        radial-gradient(700px 500px at 85% 25%, rgba(255,255,255,0.06), transparent 55%),
        radial-gradient(900px 700px at 50% 95%, rgba(255,255,255,0.05), transparent 60%),
        var(--bg);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px 16px;
    }
    .wrap{width:100%;max-width:var(--max)}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
      border:1px solid var(--stroke);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      position:relative;
    }
    header{
      padding:22px 22px 0 22px;
      display:flex;
      align-items:center;
      gap:14px;
    }
    .logo{
      width:74px;height:74px;border-radius:18px;object-fit:cover;
      border:1px solid var(--stroke);background:rgba(255,255,255,0.05);
      flex:0 0 auto;
    }
    h1{margin:0;font-size:30px;line-height:1.1;letter-spacing:0.2px}
    .subtitle{
      margin-top:6px;font-size:14.5px;color:var(--muted);letter-spacing:0.2px
    }

    .content{padding:12px 22px 20px 22px}
    .welcome{
      margin-top:10px;
      color:var(--text);
      font-size:16px;
      line-height:1.6;
      max-width:78ch;
    }
    .welcome strong{font-weight:800}
    .actions{
      margin-top:16px;
      display:flex;
      flex-wrap:wrap;
      gap:12px;
    }
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid var(--stroke);
      background:var(--btn);
      color:var(--text);
      text-decoration:none;
      font-weight:700;
      letter-spacing:0.2px;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      min-width:220px;
    }
    .btn:hover{background:var(--btnHover);border-color:rgba(255,255,255,0.20);transform:translateY(-1px)}
    .btn:active{transform:translateY(0)}
    .icon{width:18px;height:18px;display:inline-block;flex:0 0 auto}

    .searchBox{
      margin-top:18px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .searchBox input{
      width:100%;
      max-width:640px;
      padding:14px 16px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,0.16);
      background: rgba(0,0,0,0.25);
      color: var(--text);
      outline:none;
      font-size:16px;
    }
    .helper{
      margin-top:10px;
      color:rgba(255,255,255,0.70);
      font-size:13.5px;
      line-height:1.5;
    }

    .results{
      margin-top:16px;
      display:grid;
      gap:12px;
    }
    .item{
      display:flex;
      gap:12px;
      align-items:center;
      padding:12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.04);
    }
    .thumb{
      width:66px;height:66px;border-radius:14px;object-fit:cover;
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.10);
      flex:0 0 auto;
    }
    .meta{min-width:0;flex:1}
    .title{
      font-weight:800;
      line-height:1.25;
      margin-bottom:10px;
      word-break: break-word;
    }
    .itemActions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .mini{
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.08);
      color: var(--text);
      text-decoration:none;
      font-weight:750;
      font-size:14px;
    }
    .mini:hover{background: rgba(255,255,255,0.12)}
    .empty{
      padding:14px;
      border-radius:16px;
      border:1px dashed rgba(255,255,255,0.22);
      color: rgba(255,255,255,0.78);
      line-height:1.5;
      background: rgba(255,255,255,0.03);
    }

    footer{
      padding:14px 22px 18px 22px;
      border-top:1px solid var(--soft);
      color:var(--muted);
      font-size:13px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    @media (max-width: 520px){
      header{padding:18px 18px 0 18px}
      .content{padding:10px 18px 18px 18px}
      footer{padding:12px 18px 16px 18px}
      .logo{width:62px;height:62px;border-radius:16px}
      h1{font-size:27px}
      .btn{width:100%;min-width:0}
      .searchBox input{max-width:100%}
    }
  </style>
</head>

<body>
  <main class="wrap">
    <section class="card" role="region" aria-label="Amado Libros">

      <header>
        <img class="logo" src="/public/A%20Gato.jpeg" alt="Logo Amado Libros" />
        <div>
          <h1>Amado Libros</h1>
          <div class="subtitle">Catálogo curado · Libros importados · Pedidos especiales</div>
        </div>
      </header>

      <div class="content">
        <div class="welcome">
          <strong>Bienvenido a Amado Libros.</strong> Nos encanta atenderte. Buscá por título, autor o tema.
          Mostramos los últimos artículos publicados y, si no aparece, consultanos por WhatsApp y lo buscamos por vos.
        </div>

        <div class="actions">
          <a class="btn" href="https://www.mercadolibre.com.uy/tienda/amado-libros-libreria-en-linea" target="_blank" rel="noopener">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
              <path fill="currentColor" d="M12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2Zm0 2C7.582 4 4 7.582 4 12s3.582 8 8 8 8-3.582 8-8-3.582-8-8-8Z"/>
              <path fill="currentColor" d="M8.4 10.2c.4-1.4 1.7-2.2 3.6-2.2s3.2.8 3.6 2.2c.2.8 0 1.5-.6 2-.5.4-1.2.7-2.1.9l-.6.1c-.9.2-1.3.4-1.3.9v.2h-2v-.2c0-1.6 1.2-2.2 2.8-2.5l.6-.1c.6-.1 1-.3 1-.6 0-.3-.2-.5-.6-.7-.4-.2-.9-.3-1.5-.3s-1.1.1-1.5.3c-.4.2-.6.4-.6.7H8.2c0-.2 0-.5.2-.9Z"/>
              <path fill="currentColor" d="M10 16h4v2h-4z"/>
            </svg>
            Tienda Mercado Libre
          </a>

          <a class="btn" href="https://wa.me/59899841325" target="_blank" rel="noopener">
            <svg class="icon" viewBox="0 0 32 32" aria-hidden="true">
              <path fill="currentColor" d="M19.11 17.2c-.28-.14-1.65-.81-1.91-.9-.25-.09-.44-.14-.62.14-.18.28-.71.9-.87 1.08-.16.18-.32.21-.6.07-.28-.14-1.18-.43-2.24-1.37-.83-.74-1.39-1.65-1.55-1.93-.16-.28-.02-.43.12-.57.12-.12.28-.32.42-.48.14-.16.18-.28.28-.46.09-.18.05-.35-.02-.5-.07-.14-.62-1.5-.85-2.06-.22-.53-.45-.46-.62-.47h-.53c-.18 0-.46.07-.71.35-.25.28-.93.9-.93 2.2 0 1.3.95 2.56 1.08 2.74.14.18 1.87 2.85 4.54 4 .64.28 1.14.45 1.53.58.64.2 1.22.17 1.68.1.51-.08 1.65-.67 1.88-1.32.23-.65.23-1.2.16-1.32-.07-.12-.25-.2-.53-.34Z"/>
              <path fill="currentColor" d="M26.67 15.33c0 5.99-4.86 10.84-10.85 10.84-1.9 0-3.69-.49-5.25-1.35L5.33 26.67l1.9-5.05a10.78 10.78 0 0 1-1.9-6.29C5.33 9.34 10.19 4.5 16.18 4.5c5.99 0 10.49 4.84 10.49 10.83Zm-2.1 0c0-4.83-3.9-8.74-8.39-8.74-4.83 0-8.75 3.91-8.75 8.74 0 2.2.7 3.85 1.82 5.45l-1.1 3.07 3.2-1.02c1.5 1 3.29 1.58 5.83 1.58 4.49 0 8.39-3.91 8.39-8.74Z"/>
            </svg>
            WhatsApp
          </a>
        </div>

        <div class="searchBox">
          <input id="q" type="search" placeholder="Buscar libros, autor, ISBN, tema..." autocomplete="off" />
        </div>

        <div class="helper" id="helper">
          Mostrando los últimos publicados. Si buscás algo y no aparece, escribinos por WhatsApp.
        </div>

        <div id="results" class="results"></div>

        <div id="fallback" class="empty" style="display:none; margin-top:14px;">
          No pude cargar el catálogo todavía. Probá de nuevo en un minuto o consultanos por WhatsApp.
        </div>
      </div>

      <footer>
        <div>© Amado Libros — Librería en línea</div>
      </footer>
    </section>
  </main>

  <script>
    const CATALOG_URL = "./catalogo_amado_libros.json";
    const WHATSAPP_NUMBER = "59899841325";

    let CATALOG = [];

    function normalize(s) {
      return (s || "")
        .toString()
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .trim();
    }

    function waLink(title, permalink) {
      const msg = `Hola! Estoy en amadolibros.com y me interesa: ${title}. ¿Me confirmás disponibilidad? ${permalink || ""}`.trim();
      return `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`;
    }

    function guessPermalink(item) {
      // Si tu JSON ya trae permalink, mejor. Si no, intentamos usar lo que haya.
      return item.permalink || item.link || item.url || "";
    }

    function guessThumb(item) {
      return item.thumbnail || item.picture || item.image || item.img || "";
    }

    function guessTitle(item) {
      return item.title || item.nombre || item.name || "";
    }

    function render(items) {
      const box = document.getElementById("results");
      if (!box) return;

      if (!items.length) {
        box.innerHTML = `<div class="empty">No encontré resultados. Si querés, consultanos por WhatsApp y lo buscamos por vos.</div>`;
        return;
      }

      box.innerHTML = items.map(item => {
        const title = guessTitle(item);
        const permalink = guessPermalink(item);
        const thumb = guessThumb(item);

        return `
          <article class="item">
            <img class="thumb" src="${thumb}" alt="${title}">
            <div class="meta">
              <div class="title">${title}</div>
              <div class="itemActions">
                <a class="mini" href="${permalink}" target="_blank" rel="noopener">Comprar en Mercado Libre</a>
                <a class="mini" href="${waLink(title, permalink)}" target="_blank" rel="noopener">WhatsApp</a>
              </div>
            </div>
          </article>
        `;
      }).join("");
    }

    async function init() {
      try {
        const r = await fetch(CATALOG_URL, { cache: "no-store" });
        if (!r.ok) throw new Error("No catalog");
        const data = await r.json();

        // Acepta dos formatos:
        // 1) { items: [...] }
        // 2) [...] (array directo)
        const items = Array.isArray(data) ? data : (data.items || data.results || []);
        CATALOG = items.map(x => ({
          ...x,
          _k: normalize(`${guessTitle(x)} ${x.id || ""} ${x.isbn || ""}`)
        }));

        // Mostrar “últimos” por defecto (primeros 12)
        render(CATALOG.slice(0, 12));

        const input = document.getElementById("q");
        input.addEventListener("input", () => {
          const q = normalize(input.value);
          if (!q) {
            render(CATALOG.slice(0, 12));
            return;
          }
          const out = CATALOG
            .filter(x => x._k.includes(q))
            .slice(0, 24);
          render(out);
        });

      } catch (e) {
        document.getElementById("fallback").style.display = "block";
      }
    }

    init();
  </script>
</body>
</html>
