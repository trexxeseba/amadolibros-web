<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Amado Libros | Catálogo Premium Uruguay</title>
    <script src="[https://cdn.tailwindcss.com](https://cdn.tailwindcss.com)"></script>
    <link href="[https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap](https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap)" rel="stylesheet">
    <link rel="stylesheet" href="[https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css](https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css)">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #fcfcfc; }
        .glass-header { background: rgba(10, 10, 10, 0.96); backdrop-filter: blur(20px); }
        .book-card { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .book-card:hover { transform: translateY(-6px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
    </style>
</head>
<body class="min-h-screen flex flex-col text-slate-900">
    <header class="glass-header text-white sticky top-0 z-50 border-b border-white/10 h-16 flex items-center justify-between px-4">
        <div class="flex items-center gap-2 cursor-pointer" onclick="window.location.href='/'">
            <div class="bg-orange-500 p-1.5 rounded-lg"><i class="fas fa-book-open"></i></div>
            <h1 class="text-xl font-black uppercase">Amado<span class="text-orange-500">Libros</span></h1>
        </div>
        <a href="[https://wa.me/59899841325](https://wa.me/59899841325)" target="_blank" class="bg-green-600 px-4 py-2 rounded-xl text-xs font-bold transition-all shadow-lg flex items-center gap-2">
            <i class="fab fa-whatsapp"></i> WHATSAPP
        </a>
    </header>
    <main class="flex-grow max-w-7xl mx-auto px-4 py-8 w-full">
        <div id="statusContainer" class="hidden py-20 text-center animate-fade-in"></div>
        <div id="mainContent">
            <div class="mb-8">
                <h2 class="text-2xl font-black text-slate-900 tracking-tight">Catálogo Destacado</h2>
                <p id="counter" class="text-slate-500 text-xs mt-1">Sincronizando catálogo...</p>
            </div>
            <div id="grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-6"></div>
        </div>
    </main>
    <script>
        const API_BASE = window.location.hostname.includes('amadolibros') ? '' : '[https://amadolibros-web.pages.dev](https://amadolibros-web.pages.dev)';
        let allBooks = [];

        async function init() {
            try {
                const res = await fetch(`${API_BASE}/api/home`);
                if (!res.ok) throw new Error("Servidor no responde (Falla de Red)");
                const data = await res.json();
                if (data.error === "KV_EMPTY") { showSetupState(); return; }
                allBooks = Array.isArray(data) ? data : (data.results || []);
                document.getElementById('counter').textContent = `${allBooks.length} LIBROS EN STOCK`;
                render(allBooks);
            } catch (e) {
                showErrorState(e.message);
            }
        }

        function render(list) {
            const grid = document.getElementById('grid');
            document.getElementById('statusContainer').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('hidden');
            grid.innerHTML = list.map(b => `
                <div class="book-card bg-white p-3 rounded-2xl border border-slate-100 shadow-sm animate-fade-in">
                    <img src="${b.thumbnail?.replace('-I.jpg', '-V.jpg')}" class="w-full aspect-[3/4] object-contain p-2" loading="lazy">
                    <h3 class="font-bold text-slate-800 text-[13px] line-clamp-2 mt-2 h-8">${b.title}</h3>
                    <p class="text-lg font-black mt-2">$${b.price}</p>
                </div>
            `).join('');
        }

        function showSetupState() {
            document.getElementById('mainContent').classList.add('hidden');
            const c = document.getElementById('statusContainer');
            c.classList.remove('hidden');
            c.innerHTML = `<div class="p-10"><h3>Base de datos vacía</h3><a href="/api/sync-all-books" class="bg-orange-600 text-white px-6 py-2 rounded-xl">Sincronizar ahora</a></div>`;
        }

        function showErrorState(msg) {
            document.getElementById('mainContent').classList.add('hidden');
            const c = document.getElementById('statusContainer');
            c.classList.remove('hidden');
            c.innerHTML = `<div class="p-10 bg-red-50 text-red-600 rounded-3xl"><h3 class="font-bold">Error Crítico</h3><p>${msg}</p></div>`;
        }
        window.onload = init;
    </script>
</body>
</html>
